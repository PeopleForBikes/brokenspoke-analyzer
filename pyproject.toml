[tool.poetry]
name = "brokenspoke-analyzer"
version = "2.0.0-rc"
description = "Run a BNA analysis locally."
authors = [
  "RÃ©my Greinhofer <remy.greinhofer@gmail.com>",
  "Luis Alvergue <lalver1@gmail.com>",
]
license = "MIT"

[tool.poetry.dependencies]
python = "^3.10"
aiohttp = "^3.8.6"
boto3 = "^1.28.64"
geopandas = "^0.14.0"
loguru = "^0.7.2"
osmnx = "^1.6.0"
python-dotenv = "^1.0.0"
python-slugify = "^8.0.1"
rich = "^13.5.3"
sqlalchemy = { extras = ["asyncio", "postgresql_psycopg"], version = "^2.0.22" }
tenacity = "^8.2.3"
typer = "^0.9.0"
us = "^3.1.1"

[tool.poetry.group.dev.dependencies]
black = "^23.10.1"
bpython = "^0.24"
furo = "^2023.9.10"
isort = "^5.11.3"
jupyterlab = "^4.0.7"
mypy = "^1.6.1"
myst-parser = "^2.0.0"
pytest = "^7"
pytest-cov = "^4.1.0"
pytest-mock = "^3.12.0"
pytest-rerunfailures = "^12.0"
pytest-socket = "^0.6.0"
pytest-xdist = "^3.3.1"
ruff = "^0.1.1"
Sphinx = "^7.2.6"
sphinx-autobuild = "^2021.3.14"
sphinx-autodoc-typehints = "^1.24.0"
sphinx-copybutton = "^0.5.2"
sqlfluff = "^2.3.4"
types-colorama = "^0.4.15.12"
types-decorator = "^5.1.8.4"
types-jsonschema = "^4.19.0.3"
types-pygments = "^2.16.0.0"
types-python-slugify = "^8.0.0.3"
types-six = "^1.16.21.9"
xdoctest = "^1.1.0"
pandas-stubs = "^2.1.1.230928"

[tool.poetry.scripts]
bna = 'brokenspoke_analyzer.cli.root:app'

[tool.isort]
profile = "black"
force_grid_wrap = 2

[tool.coverage.run]
omit = [
  "*/__init__.py",
  "brokenspoke_analyzer/cli_.py",
  "brokenspoke_analyzer/cli/*",
  "brokenspoke_analyzer/core/constant.py",
  "brokenspoke_analyzer/core/database/*",
  "brokenspoke_analyzer/core/downloader.py",
  "brokenspoke_analyzer/core/ingestor.py",
  "brokenspoke_analyzer/core/compute.py",
  "brokenspoke_analyzer/main.py",
  "brokenspoke_analyzer/pyrosm/*",
]

[tool.pytest.ini_options]
minversion = "6.0"
addopts = "-p no:warnings --cov-report term-missing --cov-report html --xdoctest"
markers = [
  "australia",
  "canada",
  "europe",
  "france",
  "spain",
  "usa",
  "main: main test suite",
  "xs: runs under 5min",
  "s: runs under 15min",
  "m: runs under 60min (1h)",
  "l: runs under 180min (2h)",
  "xl: runs under 360min (6h)",
  "xxl: runs under 720min (12h / 1/2day)",
]

[build-system]
requires = ["poetry-core>=1.0.0"]
build-backend = "poetry.core.masonry.api"

[tool.mypy]
strict = "true"

[[tool.mypy.overrides]]
module = ["brokenspoke_analyzer.pyrosm.*"]
ignore_errors = "true"

[[tool.mypy.overrides]]
module = ["boto3", "geopandas", "osmnx", "shapely", "us"]
ignore_missing_imports = "true"

[tool.sqlfluff.core]
dialect = "postgres"
templater = "placeholder"

[tool.sqlfluff.templater.placeholder]
param_style = "colon"
block_road_buffer = 15
block_road_min_length = 30
city_default = 30
class = "primary"
core_services = 99
default_facility_width = 5
default_lanes = 2
default_parking = 1
default_parking_width = 8
default_roadway_width = 27
default_speed = 40
nb_boundary_buffer = 2680
nb_output_srid = 32613
opportunity = 99
people = 99
primary_lanes = 2
primary_speed = 40
recreation = 99
retail = 99
secondary_lanes = 2
secondary_speed = 40
state_default = 35
tertiary_lanes = 1
tertiary_speed = 30
total = 99
transit = 99
